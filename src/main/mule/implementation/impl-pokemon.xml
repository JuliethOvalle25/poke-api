<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">
	<sub-flow name="impl-get-pokemon-by-name" doc:id="e8ba76b2-88c9-42fb-945c-f69770c41f77" >
		<ee:transform doc:name="Set var pokename" doc:id="5899bfc6-4ea4-4c48-b4d9-a21234edf321" >
			<ee:variables >
				<ee:set-variable variableName="pokeName" ><![CDATA[attributes.uriParams.'pokeName']]></ee:set-variable>
			</ee:variables>
		</ee:transform>
		<flow-ref doc:name="cl-get-pokemon-by-name" doc:id="b83cf1fe-909a-4759-aed4-494478005070" name="cl-get-pokemon-by-name"/>
		<ee:transform doc:name="Set response" doc:id="fcae0f27-e58f-4c52-9a82-5dc933f817a7" >
			<ee:message >
				<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
{   
    "id": payload.id default "0",
    "name": payload.forms[0].name default "Undefined",
    "class": payload.types[0]."type".name default "Undefined",
    "weight" : payload.weight default "0",
    "size": payload.size default "Undefined",
    "speed": payload.stats[5].base_stat default "0",
    "defense": payload.stats[2].base_stat default "0",
    "attack": payload.stats[1].base_stat default "0",
    "abilities" : payload.abilities[1].ability.name default "Undefined",
    "base experience" : payload.base_experience default "0"
    
}
]]></ee:set-payload>
			</ee:message>
		</ee:transform>
	</sub-flow>
	<sub-flow name="impl-post-pokemon" doc:id="74c91780-aad2-4a45-8b5e-ccdf85a571a5" >
		<ee:transform doc:name="Transform Message" doc:id="38299b92-311a-4b36-b76e-4b8d8ef63dd2">
			<ee:message>
				<ee:set-payload><![CDATA[%dw 2.0
output application/json
---
{
	name: payload.name,
    city: payload.city,
    email: payload.email,
   pokefav: payload.pokefav reduce ((item, acc) -> acc ++ "," ++ item)
}
]]></ee:set-payload>
			</ee:message>
		</ee:transform>
		<flow-ref doc:name="cl-post-pokemon" doc:id="848fd1db-6a49-43fb-9886-50d1b456ed70" name="cl-post-pokemon"/>
		<ee:transform doc:name="Set response" doc:id="3ed310db-1d8e-4559-b6cf-a8c04acaa40d" >
			<ee:message >
				<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
{
  message: "trainer successfully created"
} as Object {encoding: "UTF-8", mediaType: "application/json"}]]></ee:set-payload>
			</ee:message>
		</ee:transform>
	</sub-flow>
</mule>
